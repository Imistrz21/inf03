<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Quiz</title>
    <link rel="stylesheet" href="styles/style.css">
</head>
<body>
<a href="40pytan.html"><h1>Wylosuj 40 pytań</h1></a>
<a href="index.html">Wszystkie Pytania</a>
<form id="quizForm"></form>
<button onclick="checkAnswers()">Sprawdź odpowiedzi</button>
<div id="result"></div>

<script>
    async function loadQuestions() {
        const response = await fetch('questions.json');
        let questions = await response.json();


        questions = questions.sort(() => 0.5 - Math.random());


        questions = questions.slice(0, 40);

        const form = document.getElementById('quizForm');
        form.dataset.totalQuestions = questions.length;

        questions.forEach((q, i) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'question';

            const questionP = document.createElement('h3');
            questionP.textContent = `${i + 1}. ${q.title}`;
            qDiv.appendChild(questionP);

            q.answers.forEach((ans, j) => {
                const inputId = `q${i}_a${j}`;

                const wrapperDiv = document.createElement('div');

                const input = document.createElement('input');
                input.type = 'radio';
                input.name = `question${i}`;
                input.id = inputId;
                input.value = ans.isCorrect;

                const label = document.createElement('label');
                label.setAttribute('for', inputId);
                label.textContent = ans.text;

                wrapperDiv.appendChild(input);
                wrapperDiv.appendChild(label);

                qDiv.appendChild(wrapperDiv);
            });

            if (q.image) {
                const img = document.createElement('img');
                img.src = q.image;
                img.alt = `Obrazek do pytania ${q.number}`;
                img.style.maxWidth = '100%';
                img.style.margin = '10px 0';
                qDiv.appendChild(img);
            }
            form.appendChild(qDiv);
        });
    }

    function checkAnswers() {
        const form = document.getElementById('quizForm');
        const questions = form.querySelectorAll('.question');
        let correctCount = 0;

        questions.forEach((question, i) => {
            const inputs = question.querySelectorAll('input[type="radio"]');
            let answered = false;
            inputs.forEach(input => {
                if (input.checked) {
                    answered = true;
                    if (input.value === "true") {
                        correctCount++;
                        input.nextElementSibling.classList.add('correct');
                    } else {
                        input.nextElementSibling.classList.add('incorrect');
                    }
                }
            });

            if (!answered) {
                const header = question.querySelector('h3');
                if (header) header.style.color = 'orange';
            }
        });

        document.getElementById('result').innerHTML = `<h2>Twój wynik: ${correctCount} / ${questions.length}</h2>`;
    }

    loadQuestions();
</script>
<script data-goatcounter="https://imistrz21.goatcounter.com/count"
        async src="//gc.zgo.at/count.js"></script>

</body>
</html>
